#!/usr/bin/env node

var api = require('../index');

var createContext = api.createContext;

var runMainOrLeafServer = api.runMainOrLeafServer;

var createApp = api.createApp;
var bindAppToServer = api.bindAppToServer;

var serveStaticFiles = api.serveStaticFiles;
var searchAndUseRoutesJs = api.searchAndUseRoutesJs;

//

Promise.resolve(createContext())
  .then(runMainOrLeafServer)
  .then(createApp)
    .then(searchAndUseRoutesJs)
    .then(serveStaticFiles)
  .then(bindAppToServer)
  .then(function(ctx){
    // console.dir(ctx);
    console.log('OK up and running');
  })
  .catch(function(err){
    console.error(err.stack||err);
    process.exit(1);
  })
;
